<!DOCTYPE html>


<html>
<head>
<script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- // Favicon -->
<link rel="shortcut icon" href="favicon.ico">
<link rel="icon" sizes="16x16 32x32 64x64" href="favicon.ico">

<title>LightO</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="data:,">
<link rel="stylesheet" type="text/css" href="style.css">

<!-- // Handle color wheel    -->
<script>
// https://iro.js.org/
// Combination of wheel and sliders
var colorPicker = new iro.ColorPicker("#picker", {
  width: 250,
  color: "rgb(255, 0, 0)",
  borderWidth: 1,
  borderColor: "#fff",
  layout: [
    {
      component: iro.ui.Wheel,
    },
    {
	  // RGB Value
      component: iro.ui.Slider,
      options: {
        sliderType: 'hue'
      }
    },
    {
	  // W value
      component: iro.ui.Slider,
      options: {
        sliderType: 'saturation'
      }
    },
    {
	  // Intensity
      component: iro.ui.Slider,
      options: {
        sliderType: 'value'
      }
    }
  ]
});


colorPicker.on('color:change', function(color){
	hue = color.hue
	sat = color.saturation
	val = color.value
	colorString = String(hue) + ',' + String(sat) + ',' + String(val)
	console.log(colorString)
	colorChange(hue, sat, val);
});

function colorChange(hue, sat, val) {
	var xhttp = new XMLHttpRequest();
	xhttp.open("GET", "get?h=" + hue + "&s=" + sat + "&v=" + val, true);
	xhttp.send();
}

function colorState(){
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			// The request has been completed successfully
			var res = this.responseText;
			console.log(res)
			
			var values = res.split(",");
			
			var hue = parseInt(values[0]);
			var sat = parseInt(values[1]);
			var val = parseInt(values[2]);
			
			console.log(hue)
			
			colorPicker.color.hsv = {h: hue, s: sat, v: val};
		}
    };
	xhttp.open("GET", "/state", true);
	xhttp.send()
}

function switchChange(){
	// TODO
}

function switchState(){
	// TODO
}
</script>


</head>

<body onload="colorState()">
    <h1><a href="https://pm1.narvii.com/6971/57895325fc3c26c281c738870748d1eb1267b128r1-547-753v2_uhq.jpg"> LightO </a>
	<!-- <div id="status" style = "display: none;">%STATE%</div> -->
	</h1>

<!-- 	<div class=switch>
		<input type="checkbox" id="switch" />
		<label for="switch">Toggle</label>
	</div> -->
	<div class="ColorPicker" id="picker"></div>
</body>
</html>